CHARACTER CONSISTENT MASTERPROMPT
=================================

You are given a story.

Your task is to extract characters and scenes using character IDs where each ID already represents a specific outfit/look.

There is NO separate outfit tracking.

1. CHARACTER EXTRACTION (MANDATORY)
Extract every character appearing anywhere in the story (major or minor).

1.1 Character Identity Rule (CRITICAL)
If the same person appears in different outfits or looks, you MUST:
- Create separate character IDs for each outfit/look
- Treat each ID as a fully independent character
‚ùå Do NOT create parent/child relationships
‚ùå Do NOT inherit or reference another character ID
Each character ID must be treated as a standalone visual entity.

1.2 Character ID Naming Convention (MANDATORY)
Use this format: {name}_outfit_001, {name}_outfit_002, {name}_outfit_003
Example: anika_outfit_001 ‚Üí Anika in outfit/look A, anika_outfit_002 ‚Üí Anika in outfit/look B
‚ö† These IDs must never reference each other.

1.3 Character Description (OUTFIT INCLUDED HERE)
For each character ID, generate a complete English description including:
- physical appearance
- personality
- clothing / outfit / accessories (fully described here)
If no info is available ‚Üí "not clearly described"

2. CHARACTER OBJECT STRUCTURE
Each character ID must follow this structure:
{ "id": "unique character ID", "name": "English name", "description": "appearance, personality, and full outfit description" }
üö´ No outfit attribute, üö´ No clothing arrays

3. CHARACTER TRACKING
List all character IDs under: output_structure.characters.included_characters

4. SCENE CONSTRUCTION (LOGICAL PRESENCE RULE)
Break the story into exactly [SCENE_COUNT] continuous scenes.

4.1 Character Presence Rules
A character ID appears in a scene ONLY IF physically present.
‚ùå Do NOT include characters who are: mentioned verbally, remembered, imagined, referenced by possession

4.2 Clothing & Appearance Rules
Do NOT describe outfits again inside scenes. A character's visual appearance is fixed by its character ID.
‚ùå No clothing_appearance field

5. SCENE STRUCTURE
Each scene must follow:
{
  "scene_number": N,
  "prompt": "Visual description of the scene start (setting, lighting, composition) using ONLY character IDs. Do NOT describe the action/motion happening over time here.",
  "video_action_prompt": "Detailed description of the motion and action that happens in this scene. e.g. 'The character walks from left to right while waving'. This describes the video evolution.",
  "characters_in_scene": ["CharacterID1"],
  "negative_prompt": "do not alter character appearances, no extra characters, no distorted features, avoid text in image"
}

6. BACKGROUND MUSIC
You must also generate a list of background music prompts.
- Divide the total story duration into blocks (approx 30-40s each, or when mood changes).
- Assume each scene is approx 8 seconds long.
- Create a `bgmusic` array where each item covers a time range and provides a music prompt.

Structure:
{
  "start_time": "0s",
  "end_time": "32s",
  "prompt": "Upbeat cinematic orchestral music, adventurous mood"
}

Story:
[STORY_TEXT]

Generate exactly [SCENE_COUNT] scenes.

=================================
JSON SCHEMA FOR STRUCTURED OUTPUT
=================================

{
  "type": "OBJECT",
  "properties": {
    "character_reference": {
      "type": "ARRAY",
      "items": {
        "type": "OBJECT",
        "properties": {
          "id": {"type": "STRING"},
          "name": {"type": "STRING"},
          "description": {"type": "STRING"}
        },
        "required": ["id", "name", "description"]
      }
    },
    "output_structure": {
      "type": "OBJECT",
      "properties": {
        "story_title": {"type": "STRING"},
        "duration": {"type": "STRING"},
        "total_scenes": {"type": "INTEGER"},
        "style": {"type": "STRING"},
        "characters": {
          "type": "OBJECT",
          "properties": {
            "included_characters": {
              "type": "ARRAY",
              "items": {"type": "STRING"}
            }
          }
        },
        "scenes": {
          "type": "ARRAY",
          "items": {
            "type": "OBJECT",
            "properties": {
              "scene_number": {"type": "INTEGER"},
              "prompt": {"type": "STRING"},
              "video_action_prompt": {"type": "STRING"},
              "characters_in_scene": {
                "type": "ARRAY",
                "items": {"type": "STRING"}
              },
              "negative_prompt": {"type": "STRING"}
            },
            "required": ["scene_number", "prompt", "video_action_prompt", "characters_in_scene"]
          }
        },
        "bgmusic": {
          "type": "ARRAY",
          "items": {
            "type": "OBJECT",
            "properties": {
              "start_time": {"type": "STRING"},
              "end_time": {"type": "STRING"},
              "prompt": {"type": "STRING"}
            },
            "required": ["start_time", "end_time", "prompt"]
          }
        }
      }
    }
  },
  "required": ["character_reference", "output_structure"]
}
